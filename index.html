<!DOCTYPE html>
<html data-theme="dark">

<head>
    <meta charset="UTF-8">
    <title>Lingle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:title" content="Lingle â€“ Iedere dag een nieuw woord">
    <meta property="og:description" content="Raad het woord in 6 pogingen, nu met de nostalgische look die je gewend bent.">
    <meta property="og:url" content="https://kaasiand.cool/">
    <meta property="og:image" content="https://kaasiand.cool/lingle/banner.png">
    <meta property="twitter:domain" content="kaasiand.cool">
    <meta property="twitter:site" content="@kaasIand">
    <meta property="twitter:creator" content="@kaasIand">

    <meta name="theme-color" content="#f9c418">
    <meta name="twitter:card" content="summary_large_image">


    <link rel="icon" href="favicon.png" sizes="16x16">
    <style>
        :root {
            height: 100%;
        }
        :root[data-theme="dark"] {
            background: #3a3535;
        }
        :root[data-theme="light"] {
            background: #cfc6c6;
        }
        :root[data-theme="kaasiand"] {
            background: #5F2900 repeat url(../assets/wood.bmp);
        }
        @font-face {
            font-family: "tahoma";
            src: url("Tahoma.woff") format('woff');
        }
        @font-face {
            font-family: "wingdings";
            src: url("wingdings.woff") format('woff');
        }

        @keyframes win {
               0% { opacity: 0; }
             0.1% { opacity: 1; }
            50.0% { opacity: 0; }
            75.0% { opacity: 1; }
             100% { opacity: 0; }
        }

        .winanim td:nth-child(1) .glow::after { animation: win 1.00s ease 0.20s both; }
        .winanim td:nth-child(2) .glow::after { animation: win 1.05s ease 0.15s both; }
        .winanim td:nth-child(3) .glow::after { animation: win 1.10s ease 0.10s both; }
        .winanim td:nth-child(4) .glow::after { animation: win 1.15s ease 0.05s both; }
        .winanim td:nth-child(5) .glow::after { animation: win 1.20s ease 0.00s both; }

        body {
            margin: 0px;
            height: 100%;
        }

        .top {
            display: flex;
            justify-content: center;
            height: 100%;
            overflow: hidden;

            --height: min(450px, 55vh);
            --hdrheight: 75px;
            --width: min(400px, calc(100vw - 10px));
        }

        .wrap {
            margin-top: var(--hdrheight);

            --min: min(var(--height), var(--width));
            --htpx: calc(0.005 * var(--height));
            --hhpx: calc(0.0025 * var(--height));
            --minpx: calc(0.005 * var(--min));

            background-image: linear-gradient(to bottom, #4c7aa5 0%, #1d557a 50%, #0c4363 100%);
            font-size: min(calc(0.145 * var(--height)), calc(0.16 * var(--width)));

            --width: min(min(400px, calc(100vw - 10px)), calc(100vw - 60px));
            --height: min(420px, 50vh);
            width: var(--width);
            height: var(--height);
            overflow: hidden;
            transition: transform 1s ease;
            /*--tilt: 0deg;
            transform: perspective(800px) rotateY(var(--tilt));*/
            --duration: .6s;
        }
        .wrap.blur {
            filter: blur(calc(0.0025 * var(--min)));
        }

        #speelveld {
            border-collapse: collapse;
            width: 100%;
            transition: margin-top .5s linear;
            overflow: hidden;
            text-transform: uppercase;
        }
        #speelveld.zesdebeurt {
            margin-top: calc(var(--height) * -.2);
        }
        #speelveld.revealantwoord {
            margin-top: calc(var(--height) * -.4);
        }
        #speelveld td {
            padding: 0;
            margin: 0;
        }
        .letterbox {
            height: calc(var(--height) / 5);
            overflow: hidden;
            position: relative;
            font-family: "tahoma";
            text-align: center;
            padding: 0;
        }
        .glow::after, .letterbg::after {
            position: absolute;
            content: "";
            width: calc(100% + calc(10 * var(--minpx)));
            height: calc(100% + calc(10 * var(--minpx)));
            border: calc(6 * var(--minpx)) solid #8D8D8D;
            border-left-width: calc(6.5 * var(--minpx));
            border-right-width: calc(6.5 * var(--minpx));
            border-radius: calc(8 * var(--minpx));
            box-sizing: border-box;
            left: calc(-5 * var(--minpx));
            top: calc(-5 * var(--minpx));
        }
        .glow::after {
            background-color: white;
            box-shadow: inset 0px calc(-0.005 * var(--height)) calc(0.005 * var(--height)) black;
            opacity: 0;
        }
        .letterbg::after {
            box-shadow: inset calc(0.0075 * var(--height)) calc(0.0125 * var(--height)) calc(0.01 * var(--height)) #000C;
        }
        .letter {
            position: absolute;
            width: 100%;
            top: 50%;
            transform: translateY(-55%);
            opacity: 0;
            transition: opacity 0.05s ease;
        }
        .dotreveal .letter {
            transition: opacity 0.3s ease;
        }
        #speelveld tr:nth-child(7) .letter {
            transition: opacity 0s ease;
        }

        .letter::after {
            width: 100%;
            height: 100%;
            content: var(--letter);
            color: white;
        }

        .letter {
            filter: drop-shadow(calc(2 * var(--htpx)) calc(2 * var(--htpx)) calc(2 * var(--htpx)) #0009)
                    drop-shadow(var(--htpx) var(--htpx) calc(2 * var(--htpx)) #0009)
                    drop-shadow(0 0 var(--htpx) #0007)
                    drop-shadow(0 0 calc(0.3 * var(--htpx)) #000C)
        }

        .letterbox[data-bg="geel"] .letterbg::before {
            position: absolute;
            content: "";
            top: 0;
            left: calc(3 * var(--minpx));
            display: block;
            width: calc(100% - calc(5 * var(--minpx)));
            height: 100%;
            background-color: #f9c418;
            border-radius: 50%;
            box-shadow: 0 0 calc(5 * var(--minpx)) black;
        }
        .letterbox[data-bg="rood"] .letterbg::before {
            position: absolute;
            content: "";
            top: 0;
            left: 0;
            display: block;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(to bottom, #922618, #dd523c);
            box-shadow: inset 0 var(--minpx) calc(3.5 * var(--minpx)) black;
        }



        .btmwrap {
            --mh: calc(calc(calc(100vh - var(--height)) - var(--hdrheight)) - 40px);
            max-height: var(--mh);
            position: absolute;
            bottom: 8px;
            opacity: 1;
            pointer-events: all;
            transition: transform 2s cubic-bezier(.25,.1,.25,1),
                        opacity 0.6s step-end;
        }
        .kbwrap.flip, .wincardwrap:not(.flip) {
            transform: rotateY(180deg);
            opacity: 0;
            pointer-events: none;
        }
        .wincardwrap.flip {
            transform: rotateY(360deg);
            opacity: 1;
            pointer-events: all;
        }
        .keybline {
            height: 70px;
            max-height: calc(var(--mh) / 3);
            display: flex;
            justify-content: center;
            padding-top: 5px;
            box-sizing: border-box;
        }

        .keybline button {
            position: relative;
            box-sizing: border-box;
            min-width: calc(min(calc(100vw - 10px), 500px) * 0.09); /* fucking hell ios */
            width: calc(min(calc(100vw - 10px), 500px) * 0.09);
            height: 100%;
            padding: 0;
            text-align: center;
            cursor: pointer;

            text-transform: uppercase;
            
            --fs: min(min(40px, calc(var(--mh) / 6)), calc(var(--width) / 12));
            font-size: var(--fs);

            margin: 0 calc(min(calc(100vw - 10px), 500px) * 0.005) 0;

            font-family: "tahoma";
            color: white;
            border: none;
            border-radius: 3px;
            box-shadow: 1px 1px 3px #fff3 inset, -1px -1px 3px #0003 inset, 1px 1px 2px #0004;
            touch-action: manipulation;
        }

        .keybline button[data-bg="geel"] .btncircle::before {
            position: absolute;
            content: "";
            top: 50%;
            left: 51%;
            transform: translate(-50%,-52%);
            display: block;
            width: 90%;
            height: calc(var(--fs) * 1.9);
            background-color: #f9c418;
            border-radius: 50%;
            box-shadow: 0 0.2px 5px black;
        }
        .btnletter {
            filter: drop-shadow(1px 1px 3px #0009)
                    drop-shadow(2px 2px 2px #0009)
                    drop-shadow(0 0 1px #000F)
                    /* blur(0.25px); */
        }
        .btnletter::after {
            content: var(--letter);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-55%);
        }
        .keybline button[data-bg="zwart"] {
            filter: brightness(0.6);
        }
        @media (any-hover: hover) {
            .keybline button:hover, .sharebtn:hover {
                filter: brightness(120%);
            }
            .keybline button[data-bg="zwart"]:hover {
                filter: brightness(0.7);
            }
            #notifbox button:hover {
                background: #0002;
            }
        }
        .keybline button:active {
            filter: brightness(90%) saturate(110%);
            box-shadow: -1px -1px 3px #fff3 inset, 1px 1px 3px #0003 inset, 1px 1px 2px #0004;
        }

        .keybline:nth-child(1) button {
            background: linear-gradient(to top, #255e85, #4c7aa5);
        }
        .keybline:nth-child(2) button {
            background: linear-gradient(to top, #1d5377, #255e85);
        }
        .keybline:nth-child(3) button {
            background: linear-gradient(to top, #0c4363, #1d5377);
        }

        .keybline button[data-bg="rood"] {
            background: linear-gradient(to bottom, #922618, #dd523c);
            box-shadow: 1px 1px 3px #ffa2a290 inset, -1px -1px 3px #420606b0 inset, 1px 1px 2px #0004;
        }
        .keybline button[data-bg="rood"]:active {
            box-shadow: -1px -1px 3px #ffa2a260 inset, 1px 1px 3px #420606b0 inset, 1px 1px 2px #0004;
        }
        .wide {
            width: calc(75px + 0.75%) !important;
            max-width: 14% !important;
        }
        .enter .btnletter::after {
            font-size: 90%;
            transform: translate(-50%,-55%) scaleX(0.75);
            text-transform: lowercase;
        }


        .header {
            max-width: calc(100vw - 10px);
            height: var(--hdrheight);
            position: absolute;
        }

        .logo {
            height:100%;
            padding: 10px 0 5px; 
            box-sizing: border-box;
            filter: drop-shadow(2px 2px 2px #0004);
        }
        :root[data-theme="light"] .logo {
            filter: saturate(1.1) brightness(0.85) drop-shadow(2px 2px 2px #0004);
        }

        #notifbox {
            position: fixed;
            display: block;
            background: #f9c418;
            width: min(350px, 95vw);
            padding: 10px 35px 10px 15px;
            margin: 10px;
            border-radius: 8px;
            box-sizing: border-box;
            box-shadow: 1px 2px 5px #000C;
            font-family: "tahoma";
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        #notifbox button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background-color: transparent;
            border: none;
            font-size: x-large;
            border-radius: 50%;
            box-sizing: border-box;
            min-width: 25px;
            width: 25px;
            height: 25px;
            transition: background-color 0.05s ease;
        }
        #notifbox button::before, #notifbox button::after {
            content: "";
            position: absolute;
            display: block;
            background-color: #222;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%) rotate(45deg);
        }
        #notiftext {
            pointer-events: none;
        }
        #notifbox button::before {
            width: 2px;
            height: 15px;
        }
        #notifbox button::after {
            width: 15px;
            height: 2px;
        }
        #notifbox button:active {
            background: #0004;
        }

        .sharebtn {
            width: min(95vw, 250px);
            height: min(60px,calc(var(--mh) / 2));
            
            background: linear-gradient(to top, #922618, #dd523c);
            box-shadow: 1px 1px 3px #ffa2a290 inset, -1px -1px 3px #420606b0 inset, 1px 1px 2px #0004;
            
            font-size: 24px;

            font-family: "tahoma";
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            text-shadow: 1px 1px 2px #000C;
        }

    </style>
</head>

<body onload="init()">
<div class="top">
    <div class="header">
        <img src="lingle.png" alt="Lingle logo" class="logo">
    </div>
    <div class="wrap blur">
    <table id="speelveld">
        <tr class="dotreveal">
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
        </tr>
        <tr class="dotreveal">
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
        </tr>
        <tr class="dotreveal">
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
        </tr>
        <tr class="dotreveal">
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
        </tr>
        <tr class="dotreveal">
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
        </tr>
        <tr class="dotreveal">
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:'.'"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
        </tr>
        <tr>
            <td class="letterbox" data-bg="" style="--letter:''"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:''"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:''"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:''"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
            <td class="letterbox" data-bg="" style="--letter:''"><div class="letterbg"></div><div class="glow"></div><div class="letter"></div></td>
        </tr>
    </table>
    </div>
    <div class="btmwrap kbwrap">
        <div class="keybline">
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'q'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'w'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'e'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'r'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'t'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'y'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'u'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'i'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'o'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'p'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
        </div>
        <div class="keybline">
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'a'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'s'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'d'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'f'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'g'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'h'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'j'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'k'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'l'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'Ä³'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
        </div>
        <div class="keybline">
            <button onclick="tryEnter()" class="wide enter" style="--letter:'enter'"><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'z'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'x'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'c'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'v'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'b'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'n'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="typLetter(this.style.getPropertyValue('--letter')[1])" style="--letter:'m'" data-bg=""><div class="btncircle"></div><div class="btnletter"></div></button>
            <button onclick="doBackspace()" class="wide bsp" style="--letter:'Ã•';font-family: 'wingdings'"><div class="btnletter"></div></button>
        </div>
    </div>
    <div class="btmwrap wincardwrap">

        <button class="sharebtn" onclick="copyresults()">Deel resultaten</button>
    </div>
    <div id="notifbox">
        <span id="notiftext"></span>
        <button class="closenotif" onclick="closeNotif()"></button>
    </div>
</div>
<script src="all.js"></script>
<script>
const maxlen = 5;
let mwlen;
let refuseInput = true;
let keyb = {};
let notifIdx = -1;
let sessiondate, sessionmonth, sessionseed;
let typwoordLast = "", typwoord = "";

let gamedata = {};

function copyresults() {
    let str = `Lingle ${(sessionseed - Date.UTC(2022,0,-29)) / 86400000
    } ${gamedata.voltooid ? gamedata.regel + 1 : 'X'}/6\nhttps://kaasiand.cool/lingle/\n`
    
    let trs = document.querySelectorAll("#speelveld tr");

    for (let i = 0; i < gamedata.veld.length; i++) {
        if (!gamedata.veld[i]) {
            break;
        }
        str += "\n";
        let res = checkWoord(gamedata.veld[i]);

        [...trs[i].children].forEach((el,m) => {
            if (el.dataset.bg == "rood")
                str += "ðŸŸ§"
            else if (el.dataset.bg == "geel")
                str += "ðŸŸ¡"
            else
                str += "ðŸŸ¦"
        });

        if (res.every(a => a == "rood")) {
            doaflip();
            haswon = true;
        }
    }

    navigator.clipboard.writeText(str);
}

function save() {
    localStorage.setItem("data", JSON.stringify(gamedata));
}
function tryRetrieveData() {
    if (!localStorage || localStorage.length == 0) {
        makeFirstGameData();
    }
    else {
        gamedata = JSON.parse(localStorage.getItem("data"));

        if (gamedata.datum != sessionseed) {
            makeGameDataNewDay();
        }
    }
    save();
}

function resetData() {
    localStorage.removeItem("data");
}
function makeGameDataNewDay() {
    gamedata.datum = sessionseed;
    gamedata.voltooid = false;
    gamedata.veld = ["","","","","",""];
    gamedata.regel = 0;
}
function makeFirstGameData() {
    gamedata = {
        datum: sessionseed,
        voltooid: false,
        veld: ["","","","","",""],
        regel: 0,

        verdeling: [0,0,0,0,0,0,0],
        gespeeld: 0,
        streak: 0,
        maxstreak: 0,
        wins: 0,

        thema: "dark",
        stÄ³l: "00s",
        vervangÄ²: true,
    };
}

function newNotif(txt, dur = 3000) {
    notifIdx++;
    notifbox.style.opacity = 1;
    notiftext.innerHTML = txt;
    let a = notifIdx;
    setTimeout(() => {
        if (a == notifIdx)
            notifbox.style.opacity = 0;
    }, dur);
}
function closeNotif() {
    notifbox.style.opacity = 0;
    notifbox.querySelector("button").blur();
}

function doaflip() {
    [...document.querySelectorAll(".btmwrap")].forEach(e => e.classList.add("flip"));
}

function getIdx(seed) {
    return ((((214013 * seed + 2531011) % 2147483648) >> 16) % 32768) % mwlen;
}

function handleWin() {
    gamedata.voltooid = true;
    doaflip();
    console.log("win");

    gamedata.gespeeld++;
    gamedata.streak++;
    gamedata.verdeling[gamedata.regel]++;
    gamedata.wins++;
    if (gamedata.streak > gamedata.maxstreak) gamedata.maxstreak = gamedata.streak;
    save();
}

function checkWoord(poging) {
    let wrd = [...mogelÄ³kewoorden[getIdx(gamedata.datum)]];
    let result = Array(maxlen).fill("");

    // pass 1: rood
    for (let i = 0; i < maxlen; i++) {
        if (wrd[i] == poging[i]) {
            result[i] = "rood";
            wrd[i] = "";
        }
    }
    // pass 2: geel
    for (let i = 0; i < maxlen; i++) {
        if (result[i]) continue; //skip if rode letter
        let a = wrd.indexOf(poging[i])
        if (a != -1) {
            result[i] = "geel";
            wrd[a] = "";
        }
    }
    return result;
}

function tryEnter() {
    if (typwoord.length < maxlen) {
        if (typwoord.length)
            newNotif("Dit woord is te kort.", 3000)
        return;
    }

    let firstletter = typwoord[0];
    if (allewoorden[firstletter].includes(typwoord)) {
        refuseInput = true;
        gamedata.veld[gamedata.regel] = typwoord;
        let res = checkWoord(typwoord);

        let c = document.querySelector("#speelveld tbody").children[gamedata.regel].children;

        for (let i = 0; i < maxlen; i++) {
            setTimeout(() => {
                c[i].dataset.bg = res[i];
                if (res[i] == "rood") {
                    keyb[typwoord[i]].dataset.bg = "rood";
                } else if (res[i] == "geel") {
                    if (keyb[typwoord[i]].dataset.bg == "")
                        keyb[typwoord[i]].dataset.bg = "geel";
                } else {
                    if (keyb[typwoord[i]].dataset.bg == "")
                        keyb[typwoord[i]].dataset.bg = "zwart";
                }
            }, 250 * i + 100)
        }

        if (res.every(a => a == "rood")) {
            // if win
            setTimeout(() => {
                document.querySelectorAll("#speelveld tr")[gamedata.regel].classList.add("winanim");
                setTimeout(() => {
                    handleWin();
                }, 1200);
            }, 250 * maxlen + 100);
        }
        else {
            if (gamedata.regel == 5) { /* handle loss

                |  ||

                |  |_
            */  
                gamedata.streak = 0;
                gamedata.gespeeld++;
                gamedata.verdeling[6]++;
                revealOplossing();

            } else {
                setTimeout(() => {
                    gamedata.regel++;
                    revealDots(gamedata.regel);
                }, 250 * maxlen + 100)
            }
        }
        save();
    }
    else {
        newNotif(`&quot;${typwoord}&quot; is geen geldig woord.`, 3000);
    }
}

function revealOplossing(fast = false) {
    let wrd = mogelÄ³kewoorden[getIdx(gamedata.datum)];
    let faster = fast * 1200;
    setTimeout(() => {
        speelveld.classList.add("revealantwoord");
    }, 250 * maxlen + 100 - faster);
    [...document.querySelectorAll("#speelveld tr")[6].children].forEach((el,m) => {
        setTimeout(() => {
            el.style.setProperty("--letter",`'${wrd[m]}'`);
            el.querySelector(".letter").style.opacity = 1;
        }, 250 * maxlen + 250 * m + 800 - faster);
    });
    setTimeout(() => {
        doaflip();
    }, 500 * maxlen + 1000 - faster * 1.2);
}

function doBackspace() {
    typwoord = typwoord.slice(0, typwoord.length - 1);
    updateWoord();
}

function typLetter(ltr, echttoetsenbord = false) {
    if (typwoord[typwoord.length - 1] == "i" &&
        gamedata.vervangÄ² && ltr == "j" && echttoetsenbord) {
        
        typwoord = typwoord.slice(0, typwoord.length - 1);
        typwoord += "Ä³";
        updateWoord();

    } else if (typwoord.length < maxlen) {
        typwoord += ltr;
        updateWoord();
    }
}

function updateWoord() {
    let i;
    if (typwoord.length >= typwoordLast.length) {
        i = typwoord.length - 1;
        if (!typwoord.length) return;
    }
    else if (typwoord.length < typwoordLast.length) {
        i = typwoordLast.length - 1;
    }
    else return;

    let s = typwoord;
    let n = gamedata.regel;
    let el = document.querySelectorAll("#speelveld tr")[n].children[i];
    el.querySelector(".letter").style.opacity = 0;
    setTimeout(() => {
        write(n,s);
        el.querySelector(".letter").style.opacity = 1;
    }, 50);
    
    typwoordLast = typwoord;
}

function populateKeybObject() {
    let ltrs = [...document.querySelectorAll(".keybline")].flatMap(a => [...a.children]);

    for (let i = 0; i < ltrs.length; i++) {
        if (ltrs[i].classList.contains("wide")) continue;
        keyb[ltrs[i].style.getPropertyValue("--letter")[1]] = ltrs[i];
    }
}

const maanden = ["januari","februari","maart","april","mei","juni",
    "juli","augustus","september","oktober","november","december"];

function checkDatum() {
    let d = new Date();
    let dt = Date.UTC(d.getFullYear(),d.getMonth(),d.getDate());

    if (dt != gamedata.datum) {
        newNotif(`Let op! Dit is de Lingle van ${sessiondate} ${maanden[sessionmonth]}.`, 10000)
    }
}

function init() {
    mwlen = mogelÄ³kewoorden.length;

    let d = new Date();
    sessiondate  = d.getDate();
    sessionmonth = d.getMonth();
    sessionseed = Date.UTC(d.getFullYear(),sessionmonth,sessiondate);

    tryRetrieveData();

    populateKeybObject();

    revealStart();

    document.onfocus = () => {
        checkDatum();
    };

    document.onkeydown = e => {
        if (refuseInput)
            return;
        if (document.querySelectorAll("#speelveld tr")[gamedata.regel].classList.contains("dotreveal"))
            return;

        if (e.keyCode == 8) { // backspace
            doBackspace();
            return;
        }
        if (e.keyCode == 13) { // enter
            tryEnter();
            return;
        }

        let ch = e.key.toLowerCase();
        
        if (e.keyCode >= 65 && e.keyCode <= 90 || ch == "Ä³") {
            typLetter(ch, true);
        }
        else if (ch == ";" || ch == ":") {
            typLetter("Ä³", true)
        }

    };

console.log("HÃ©! Wees aardig tegen anderen en spoil alsjeblieft niks. \
Het is niet al te ingewikkeld om vals te spelen, maar je verpest het \
daarmee alleen maar voor jezelf en anderen.");
}

function revealStart() {
    let trs = document.querySelectorAll("#speelveld tr");
    let hasended = false, haswon = false;
    for (let i = 0; i < gamedata.veld.length; i++) {
        if (!gamedata.veld[i]) {
            gamedata.regel = i;
            break;
        }
        trs[i].classList.remove("dotreveal");
        let res = checkWoord(gamedata.veld[i]);

        [...trs[i].children].forEach((el,m) => {
            let ltr = gamedata.veld[i][m];
            el.dataset.bg = res[m];
            el.style.setProperty("--letter", `'${ltr}'`);
            el.querySelector(".letter").style.opacity = 1;

            if (res[m] == "rood") {
                keyb[ltr].dataset.bg = "rood";
            } else if (res[m] == "geel") {
                if (keyb[ltr].dataset.bg == "")
                    keyb[ltr].dataset.bg = "geel";
            } else {
                if (keyb[ltr].dataset.bg == "")
                    keyb[ltr].dataset.bg = "zwart";
            }
        });

        if (res.every(a => a == "rood")) {
            doaflip();
            hasended = true;
            haswon = true;
        }
        else if (i == 5 && res.some(a => a != "rood")) {
            speelveld.classList.add("revealantwoord");
            hasended = true;
            revealOplossing(true);
        }
    }
    if (!hasended) {
        revealDots(gamedata.regel);
    }
    else {
        gamedata.regel--;
    }
    gamedata.voltooid = haswon;
}

function revealDots(n) {
    [...document.querySelectorAll("#speelveld tr")[n].children].forEach((el,m) => {
        setTimeout(() => {
            el.querySelector(".letter").style.opacity = 1;
        }, m * 50 + ((gamedata.regel == 5) ? 500 : 0));
    });
    if (gamedata.regel == 5)
        speelveld.classList.add("zesdebeurt");
    
    setTimeout(() => {
        document.querySelectorAll("#speelveld tr")[n].classList.remove("dotreveal");
        typwoord = "";
        typwoordLast = "";
        refuseInput = false;
    }, (maxlen-1) * 50 + ((gamedata.regel == 5) ? 600 : 100));
}

function write(line, str) {
    let c = document.querySelector("#speelveld tbody").children;
    if (line >= c.length) return;

    let a = [...str];
    for (let i = 0; i < c[line].children.length; i++) {
        let ltr = a[i] ?? ".";
        if (ltr == "Ä³") ltr = "ij";
        c[line].children[i].style.setProperty("--letter", `'${ltr}'`);
    }
}

</script>
</body>

</html>